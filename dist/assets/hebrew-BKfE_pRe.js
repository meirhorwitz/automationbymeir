import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as S}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";import"./nav-_Ed4WGFi.js";const D={apiKey:"AIzaSyBDv0d_OVQsHzD_biFpkMvFrXaZguCYG58",authDomain:"automationbymeir.firebaseapp.com",projectId:"automationbymeir",storageBucket:"automationbymeir.firebasestorage.app",messagingSenderId:"216703427811",appId:"1:216703427811:web:a2c848833870a1415c91d6",measurementId:"G-D8GQDGVR08"};S(D);const B=["localhost","127.0.0.1","[::1]"].map(e=>e.toLowerCase()).includes(window.location.hostname.toLowerCase()),k=B?["/api/schedule"]:["/api/schedule","https://us-central1-automationbymeir.cloudfunctions.net/schedule"];function I(e={}){const t={...e};return t.headers={Accept:"application/json",...e.headers??{}},t}async function g(e,t={}){let a;for(const l of k)try{const n=await fetch(`${l}${e}`,I(t)),o=await n.text(),r=n.headers.get("content-type")??"";if(!r.toLowerCase().includes("application/json")){a=new Error(`Unexpected ${r||"unknown"} response from ${l}${e} (${n.status})`),console.warn(`Schedule request failed via ${l}`,{status:n.status,statusText:n.statusText,contentType:r,preview:o.slice(0,200)});continue}let s;try{s=JSON.parse(o)}catch(y){a=y,console.warn(`Schedule request returned invalid JSON via ${l}`,y);continue}if(!n.ok||!(s!=null&&s.success)){a=new Error((s==null?void 0:s.error)||`Request failed with status ${n.status}`),console.warn(`Schedule request failed via ${l}`,a);continue}return s}catch(n){a=n,console.warn(`Schedule request error via ${l}`,n)}throw a??new Error("Unable to reach the scheduling service.")}const b=document.getElementById("step1"),v=document.getElementById("step2"),$=document.getElementById("toStep2"),T=document.getElementById("toStep1"),m=document.getElementById("projectForm"),c=document.getElementById("submitBtn"),d=document.getElementById("formButtons"),f=document.getElementById("slotsLoader"),u=document.getElementById("timeSlots"),i=document.getElementById("form-message");let p=null;$.addEventListener("click",()=>{m.checkValidity()?(b.classList.remove("active"),v.classList.add("active"),d.style.display="none",c.style.display="",x()):m.reportValidity()});T.addEventListener("click",()=>{v.classList.remove("active"),b.classList.add("active"),d.style.display="none"});async function x(){f.style.display="block",u.innerHTML="",d.style.display="none";try{const e=await g("/slots");C(e.slots??[])}catch(e){console.error("Error fetching slots:",e),u.innerHTML='<p style="color: var(--danger);">Could not load available times. Please try again later.</p>',d.style.display="flex",c.style.display="none"}finally{f.style.display="none"}}function C(e){if(e.length===0){u.innerHTML='<p style="color: var(--light);">No available slots in the next 7 days. Please check back later.</p>',d.style.display="flex",c.style.display="none";return}const t={};e.forEach(o=>{const s=new Date(o).toDateString();t[s]||(t[s]=[]),t[s].push(o)});const a=new Date;a.setHours(0,0,0,0);const l=[];for(let o=0;o<7;o++){const r=new Date(a);r.setDate(a.getDate()+o),l.push(r)}let n='<div class="weekly-calendar">';l.forEach(o=>{const r=o.toDateString(),s=t[r]||[],y=o.toLocaleDateString("he-IL",{weekday:"short"}),L=o.getDate(),w=o.toLocaleDateString("he-IL",{month:"short"});n+=`
                    <div class="calendar-day">
                        <div class="calendar-day-header">
                            <span class="calendar-day-name">${y}</span>
                            <span class="calendar-day-number">${L}</span>
                            <span class="calendar-day-name" style="font-size: 0.7rem; margin-top: 0.25rem;">${w}</span>
                        </div>
                        <div class="calendar-time-slots">
                            ${s.length>0?s.map(h=>{const E=new Date(h).toLocaleTimeString("he-IL",{hour:"2-digit",minute:"2-digit",hour12:!1});return`<button type="button" class="time-slot-btn" data-value="${h}">${E}</button>`}).join(""):'<div class="calendar-empty-day">אין זמנים</div>'}
                        </div>
                    </div>
                `}),n+="</div>",u.innerHTML=n,d.style.display="flex",c.style.display="inline-block"}u.addEventListener("click",e=>{const t=e.target.closest(".time-slot-btn");t&&(document.querySelectorAll(".time-slot-btn").forEach(a=>a.classList.remove("selected")),t.classList.add("selected"),p=t.dataset.value)});m.addEventListener("submit",async e=>{if(e.preventDefault(),!p){alert("נא לבחור שעה.");return}c.disabled=!0,c.textContent="קובע פגישה...";const t=new FormData(m),a={name:t.get("name"),email:t.get("email"),details:t.get("details"),dateTime:p,lang:"he"};try{const l=await g("/book",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});m.style.display="none",i.style.display="block",i.className="success",i.innerHTML="<h3>תודה!</h3><p>פגישתך נקבעה. אימייל אישור נשלח אליך.</p>"}catch(l){console.error("Error submitting form:",l),i.style.display="block",i.className="error",i.innerHTML="<h3>שגיאה</h3><p>משהו השתבש. אנא נסה שוב או צור איתי קשר ישירות.</p>",c.disabled=!1,c.textContent="שליחה וקביעת פגישה"}});
