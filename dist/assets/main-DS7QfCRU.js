import"./modulepreload-polyfill-B5Qt9EMX.js";import{initializeApp as E}from"https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";const L={apiKey:"AIzaSyBDv0d_OVQsHzD_biFpkMvFrXaZguCYG58",authDomain:"automationbymeir.firebaseapp.com",projectId:"automationbymeir",storageBucket:"automationbymeir.firebasestorage.app",messagingSenderId:"216703427811",appId:"1:216703427811:web:a2c848833870a1415c91d6",measurementId:"G-D8GQDGVR08"};E(L);const D=["localhost","127.0.0.1","[::1]"].map(e=>e.toLowerCase()).includes(window.location.hostname.toLowerCase()),k=D?["/api/schedule"]:["/api/schedule","https://us-central1-automationbymeir.cloudfunctions.net/schedule"];function B(e={}){const t={...e};return t.headers={Accept:"application/json",...e.headers??{}},t}async function g(e,t={}){let s;for(const r of k)try{const n=await fetch(`${r}${e}`,B(t)),o=await n.text(),c=n.headers.get("content-type")??"";if(!c.toLowerCase().includes("application/json")){s=new Error(`Unexpected ${c||"unknown"} response from ${r}${e} (${n.status})`),console.warn(`Schedule request failed via ${r}`,{status:n.status,statusText:n.statusText,contentType:c,preview:o.slice(0,200)});continue}let a;try{a=JSON.parse(o)}catch(u){s=u,console.warn(`Schedule request returned invalid JSON via ${r}`,u);continue}if(!n.ok||!(a!=null&&a.success)){s=new Error((a==null?void 0:a.error)||`Request failed with status ${n.status}`),console.warn(`Schedule request failed via ${r}`,s);continue}return a}catch(n){s=n,console.warn(`Schedule request error via ${r}`,n)}throw s??new Error("Unable to reach the scheduling service.")}const f=document.getElementById("step1"),b=document.getElementById("step2"),T=document.getElementById("toStep2"),$=document.getElementById("toStep1"),d=document.getElementById("projectForm"),m=document.getElementById("submitBtn"),h=document.getElementById("slotsLoader"),l=document.getElementById("timeSlots"),i=document.getElementById("form-message");let y=null;T.addEventListener("click",()=>{d.checkValidity()?(f.classList.remove("active"),b.classList.add("active"),I()):d.reportValidity()});$.addEventListener("click",()=>{b.classList.remove("active"),f.classList.add("active")});async function I(){h.style.display="block",l.innerHTML="";try{const e=await g("/slots");N(e.slots??[])}catch(e){console.error("Error fetching slots:",e),l.innerHTML='<p style="color: var(--danger);">Could not load available times. Please try again later.</p>'}finally{h.style.display="none"}}function N(e){if(e.length===0){l.innerHTML='<p style="color: var(--light);">No available slots in the next 7 days. Please check back later.</p>';return}const t={};e.forEach(o=>{const a=new Date(o).toDateString();t[a]||(t[a]=[]),t[a].push(o)});const s=new Date;s.setHours(0,0,0,0);const r=[];for(let o=0;o<7;o++){const c=new Date(s);c.setDate(s.getDate()+o),r.push(c)}let n='<div class="weekly-calendar">';r.forEach(o=>{const c=o.toDateString(),a=t[c]||[],u=o.toLocaleDateString(void 0,{weekday:"short"}),v=o.getDate(),w=o.toLocaleDateString(void 0,{month:"short"});n+=`
        <div class="calendar-day">
          <div class="calendar-day-header">
            <span class="calendar-day-name">${u}</span>
            <span class="calendar-day-number">${v}</span>
            <span class="calendar-day-name" style="font-size: 0.7rem; margin-top: 0.25rem;">${w}</span>
          </div>
          <div class="calendar-time-slots">
            ${a.length>0?a.map(p=>{const S=new Date(p).toLocaleTimeString(void 0,{hour:"2-digit",minute:"2-digit",hour12:!1});return`<button type="button" class="time-slot-btn" data-value="${p}">${S}</button>`}).join(""):'<div class="calendar-empty-day">No slots</div>'}
          </div>
        </div>
      `}),n+="</div>",l.innerHTML=n}l.addEventListener("click",e=>{const t=e.target.closest(".time-slot-btn");t&&(l.querySelectorAll(".time-slot-btn").forEach(s=>s.classList.remove("selected")),t.classList.add("selected"),y=t.dataset.value)});d.addEventListener("submit",async e=>{if(e.preventDefault(),!y){alert("Please select a time slot.");return}m.disabled=!0,m.textContent="Scheduling...";const t=new FormData(d),s={name:t.get("name"),email:t.get("email"),details:t.get("details"),dateTime:y,lang:"en"};try{const r=await g("/book",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});d.style.display="none",i.style.display="block",i.className="success",i.innerHTML="<h3>Thank You!</h3><p>Your meeting is scheduled. A confirmation email has been sent to you.</p>"}catch(r){console.error("Error submitting form:",r),i.style.display="block",i.className="error",i.innerHTML="<h3>Error</h3><p>Something went wrong. Please try again or contact me directly.</p>",m.disabled=!1,m.textContent="Submit & Schedule"}});
